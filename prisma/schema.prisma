generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum PipelineStatus {
  NEW
  CONTACTED
  REPLIED
  INTERVIEW
  PILOT_CANDIDATE
  PILOT_RUNNING
  WON
  LOST
}

enum ClusterFit {
  HIGH
  MEDIUM
  LOW
}

enum EmailStyle {
  SHORT
  MEDIUM
  TECHNICAL
}

enum FundingFundType {
  VC
  CVC
  ANGEL
  ANGEL_NETWORK
  ACCELERATOR
  INCUBATOR
  GRANT
  PUBLIC_PROGRAM
  COMPETITION
  VENTURE_DEBT
  OTHER
}

enum FundingStatus {
  NEW
  RESEARCHED
  WARM_INTRO
  CONTACTED
  MEETING_BOOKED
  IN_PROCESS_DD
  WON
  LOST
}

enum FundingStage {
  IDEA
  PRE_SEED
  SEED
  SERIES_A
  SERIES_B_PLUS
  GROWTH
  ANY
}

enum FundingTargetStage {
  PRE_SEED
  SEED
  SERIES_A
}

enum FundingReasonLost {
  NO_FIT
  NOT_NOW
  NO_RESPONSE
  REJECTED
  OTHER
}

enum FundingEmailStyle {
  SHORT
  MEDIUM
  TECHNICAL
  GRANT
}

enum CustomListScope {
  LEADS
  FUNDING_OUTREACH
}

enum CustomListKind {
  SINGLE_SELECT
  MULTI_SELECT
  TAGS
}

model Lead {
  id                       String         @id @default(cuid())
  companyName              String
  industry                 String
  sizeEmployees            Int
  digitalMaturity          Int
  mlActivity               Boolean        @default(false)
  mlActivityDescription    String?
  associationMemberships   Json?
  contactName              String
  contactRole              String
  contactEmail             String
  linkedinUrl              String?
  warmIntroPossible        Boolean        @default(false)
  dataTypes                Json?
  dataIntensity            Int
  competitivePressure      Int
  coopLikelihood           Int
  priorityScore            Int
  priorityLabel            Int
  hypothesis               String
  industryCluster          ClusterFit
  clusterOverride          ClusterFit?
  status                   PipelineStatus @default(NEW)
  lastContactedAt          DateTime?
  nextFollowUpAt           DateTime?
  notes                    String?
  customFieldValues        Json?
  createdAt                DateTime       @default(now())
  updatedAt                DateTime       @updatedAt

  emailDrafts              EmailDraft[]

  @@index([status])
  @@index([priorityScore])
  @@index([nextFollowUpAt])
}

model CustomFieldDefinition {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CustomListDefinition {
  id        String          @id @default(cuid())
  scope     CustomListScope
  kind      CustomListKind  @default(SINGLE_SELECT)
  name      String
  options   String[]        @default([])
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt

  @@index([scope])
  @@unique([scope, name])
}

model EmailDraft {
  id        String     @id @default(cuid())
  leadId    String
  lead      Lead       @relation(fields: [leadId], references: [id], onDelete: Cascade)
  style     EmailStyle
  subject   String
  body      String
  createdAt DateTime   @default(now())

  @@index([leadId])
}

model FundingLead {
  id                 String              @id @default(cuid())
  name               String
  fundType           FundingFundType
  category           String?
  primaryContactName String?
  primaryContactRole String?
  contactEmail       String?
  linkedinUrl        String?
  websiteUrl         String?
  stageFocus         FundingStage[]      @default([])
  targetStage        FundingTargetStage  @default(PRE_SEED)
  ticketMin          Int?
  ticketMax          Int?
  currency           String              @default("EUR")
  typicalInstrument  String?
  grantDeadline      DateTime?
  grantRequirements  String?
  thesisTags         String[]            @default([])
  industryFocus      String[]            @default([])
  geoFocus           String[]            @default([])
  warmIntroPossible  Boolean             @default(false)
  introPath          String?
  stageMatch         Int                 @default(0)
  thesisMatch        Int                 @default(0)
  geoMatch           Int                 @default(0)
  ticketMatch        Int                 @default(0)
  fitScore           Int                 @default(0)
  priority           Int                 @default(1)
  fitCluster         ClusterFit          @default(LOW)
  fitClusterOverride ClusterFit?
  status             FundingStatus       @default(NEW)
  firstContactedAt   DateTime?
  lastContactedAt    DateTime?
  nextFollowUpAt     DateTime?
  cadenceStep        Int?
  outcomeNotes       String?
  reasonLost         FundingReasonLost?
  objections         String?
  nextSteps          String?
  attachments        String[]            @default([])
  owner              String?
  sourceText         String?
  sourceUrl          String?
  lastVerifiedAt     DateTime?
  notes              String?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt

  emailDrafts        FundingEmailDraft[]

  @@index([fundType])
  @@index([status])
  @@index([priority])
  @@index([fitScore])
  @@index([nextFollowUpAt])
}

model FundingEmailDraft {
  id            String            @id @default(cuid())
  fundingLeadId String
  fundingLead   FundingLead       @relation(fields: [fundingLeadId], references: [id], onDelete: Cascade)
  style         FundingEmailStyle
  subject       String
  body          String
  createdAt     DateTime          @default(now())

  @@index([fundingLeadId])
}
